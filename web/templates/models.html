{% extends "base.html" %}

{% block content %}

<style>
/* ===== MODELS PAGE — BALENCIAGA STYLE ===== */

body {
    background: black;
}

/* Header */
.models-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 3rem;
}

.models-header h2 {
    font-size: 1.1rem;
    letter-spacing: 0.3em;
    text-transform: uppercase;
    margin: 0;
    opacity: 0.85;
}

.models-count {
    font-size: 0.7rem;
    letter-spacing: 0.25em;
    opacity: 0.5;
}

/* Grid */
.models-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
    gap: 3rem;
}

/* Card */
.model-card {
    position: relative;
    transition: transform 0.35s ease;
}

.model-card:hover {
    transform: translateY(-8px);
}

/* Image */
.model-image {
    width: 100%;
    aspect-ratio: 3 / 4;
    background: #111;
    overflow: hidden;
    border-radius: 4px;
}

.model-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    filter: brightness(0.85);
    transition: filter 0.3s ease;
}

.model-card:hover img {
    filter: brightness(1);
}

/* Info */
.model-info {
    margin-top: 1rem;
}

.model-name {
    font-size: 0.85rem;
    letter-spacing: 0.3em;
    text-transform: uppercase;
    margin-bottom: 0.4rem;
}

.model-meta {
    font-size: 0.65rem;
    letter-spacing: 0.2em;
    opacity: 0.5;
    margin-bottom: 0.8rem;
}

/* Actions */
.model-actions {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.model-actions a {
    font-size: 0.65rem;
    letter-spacing: 0.25em;
    text-transform: uppercase;
    text-decoration: none;
}

.model-actions button {
    background: none;
    border: none;
    font-size: 0.65rem;
    letter-spacing: 0.25em;
    text-transform: uppercase;
    color: #ff4d4d;
    cursor: pointer;
    padding: 0;
}

.model-actions button:hover {
    text-decoration: underline;
}

.empty-state {
    border: 1px dashed rgba(255,255,255,0.15);
    padding: 2rem;
    text-align: center;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    font-size: 0.7rem;
    opacity: 0.6;
}

.model-image img {
    opacity: 0;
    transition: opacity 280ms ease, filter 280ms ease;
}

.model-image img.is-loaded {
    opacity: 1;
}
</style>

<div class="models-header">
    <h2>Models</h2>
    <div class="models-count">
        {{ models|length }} TOTAL
    </div>
</div>

{% if models %}
    <div class="models-grid">
        {% for model in models %}
        <div class="model-card">
            <div class="model-image">
                {% if model.preview_file %}
                    <img
                        src="/media/models/{{ model.slug }}/{{ model.preview_file }}"
                        alt="{{ model.name }}"
                        loading="lazy"
                    >
                {% endif %}
            </div>

            <div class="model-info">
                <div class="model-name">{{ model.name }}</div>
                <div class="model-meta">{{ model.media_count }} FILES</div>

                <div class="model-actions">
                    <a href="/models/{{ model.slug }}{{ token_query }}">View Gallery →</a>
                    <button onclick="deleteModel('{{ model.slug }}')">Delete</button>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
{% else %}
    <div class="empty-state">No models yet</div>
{% endif %}

<script>
const adminToken = "{{ token }}";
const tokenQuery = adminToken ? `?token=${encodeURIComponent(adminToken)}` : "";

function deleteModel(slug) {
    if (!confirm(`Delete model "${slug}" and all its media? This cannot be undone.`)) {
        return;
    }

    fetch(`/models/${slug}${tokenQuery}`, {
        method: "DELETE",
        headers: adminToken ? { "X-Admin-Token": adminToken } : {}
    }).then(res => {
        if (res.ok) {
            location.reload();
        } else {
            alert("Failed to delete model.");
        }
    });
}

document.querySelectorAll(".model-image img").forEach((img) => {
    if (img.complete) {
        img.classList.add("is-loaded");
    } else {
        img.addEventListener("load", () => img.classList.add("is-loaded"));
    }
});
</script>

{% endblock %}
